<!DOCTYPE html>
<html>

<head>
    <title>GeoLocation Sound Player</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0 auto;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
            text-align: center;
            max-width: 1000px;
            padding-bottom: 4rem;
        }

        :root {
    --primary-color: #0275d8; /* Example primary color */
    --secondary-color: #4CAF50; /* Example secondary color */
    --background-color: #f4f4f4; /* Example background color */
}

body {
    background-color: var(--background-color);
    color: #333; /* Dark grey for text */
}

button {
    background-color: var(--primary-color);
    color: white;
    /* rest of your button styles */
}

button:hover {
    background-color: var(--secondary-color);
}
button:focus, button:active {
    outline: none;
    box-shadow: 0 0 0 2px var(--secondary-color); /* Adds a shadow for focus/active */
}

/* Adjust as necessary for different elements */


        h1 {
            color: #0275d8;
        }

        p,
        div {
            margin: 10px 0;
        }

        button {
            background-color: #0275d8;
            color: white;
            border: none;
            padding: 15px 30px;
            text-transform: uppercase;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #025aa5;
        }

        #map,
        #userMap {
            height: 700px;
            width: 90%;
            margin: 20px auto;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        #status,
        #distanceInfo {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 90%;
            margin: 20px auto;
        }

        #compassBox {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 90%;
            margin: 20px auto;
            text-align: left;
        }

        #compassArrow {
            display: inline-block;
            width: 30px;
            height: 30px;
            background-image: url('arrow.png');
            /* Replace with the path to your arrow icon */
            background-size: cover;
            margin-right: 10px;
        }

        #about p {
            text-align: left;
        }

        #mediaControls {
    text-align: center;
    margin-top: 20px;
}

#mediaControls button {
    background-color: #4CAF50; /* Green background */
    color: white;
    padding: 10px 20px;
    margin: 0 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#mediaControls button:hover {
    background-color: #45a049;
}

@media screen and (max-width: 768px) {
    /* Styles for screens smaller than 768px */
    body {
        font-size: 16px; /* Larger font size for readability */
    }

    #map, #userMap {
        height: 300px; /* Smaller maps for mobile */
    }

    #mediaControls button {
        padding: 8px 15px; /* Smaller buttons for mobile */
    }
}

@media screen and (min-width: 769px) {
    /* Styles for screens larger than 768px */
    body {
        font-size: 18px; /* Adjust font size for desktop */
    }

    #map, #userMap {
        height: 500px; /* Larger maps for desktop */
    }
}

    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    </script>
</head>

<body>
    <h1>GeoLocation Sound Player</h1>
    <p>Your sound will be updated based on your location every 2 seconds.</p>
    <br>
    <div id="status">
        <p id="remainingTime"></p>
    </div>
    <div id="mediaControls">
    <button id="playPauseButton">Play/Pause</button>
    <button id="stopButton">Stop</button>
</div>

    <button style="width:100%; height:60px;" id="startButton">Click to allow sounds to play</button>


    <div id="map" style="height: 400px; width: 100%;"></div>
    <br>
    <div id="distanceInfo" style="margin-top: 20px;"></div>

    <div id="compassBox">
        <h2>Next Closest Sound</h2>
        <div id="compassArrow"></div>
        <p id="soundInfo"></p>
        <p id="soundDistance"></p>
    </div>
    <div id="userMap" style="height: 400px; width: 100%; margin-top: 20px;"></div>

    <div id="about">
        <h2>About GeoLocation Sound Player</h2>
        <p>
            Welcome to the GeoLocation Sound Player! This unique web application offers an immersive audio experience
            based on your physical location. As you move through different geographic areas, the soundscape changes,
            playing location-specific audio tracks. This innovative feature utilizes real-time geolocation data to
            enhance your auditory journey. Whether you're exploring a city, a park, or just walking around your
            neighborhood, our GeoLocation Sound Player provides a dynamic and interactive way to experience sound.
        </p>
        <p>Made with love and AI.</p>
    </div>

    <script>

        // Global variables
        var currentSound = null;
        var userMap = null;
        var userMarker = null;
        var locations = [/*... your locations ...*/];


        // Define an array of locations and corresponding sound files
        var locations = [
            { latitude: 41.510434, longitude: -81.602960, soundFile: 'sound1.mp3' }, // Hypothetical coordinates around CIA
            { latitude: 41.510273, longitude: -81.602755, soundFile: 'sound4.mp3' },
            { latitude: 41.510098, longitude: -81.602483, soundFile: 'sound3.mp3' },
            { latitude: 41.510696, longitude: -81.602362, soundFile: 'sound2.mp3' },
            { latitude: 41.510080, longitude: -81.601657, soundFile: 'sound5.mp3' },

            // ... add more locations and sound files as needed


        ];

        function checkLocationPermission() {
    if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(function(position) {
            // Existing logic...
        }, function(error) {
            if (error.code == error.PERMISSION_DENIED) {
                updateStatus("Location permission denied. Please allow location access.");
            } else {
                updateStatus("Error: " + error.message);
            }
        });
    } else {
        updateStatus("Geolocation is not supported by this browser.");
    }
}

function togglePlayPause() {
    if (currentSound && currentSound.audio) {
        if (currentSound.audio.paused) {
            currentSound.audio.play();
        } else {
            currentSound.audio.pause();
        }
    }
}

function stopSound() {
    if (currentSound && currentSound.audio) {
        currentSound.audio.pause();
        currentSound.audio.currentTime = 0;
    }
}

        function checkLocationAndUpdateSound() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var closestLocation = findClosestLocation(position.coords.latitude, position.coords.longitude);
                    if (closestLocation) {
                        var minDistance = getDistance(position.coords.latitude, position.coords.longitude, closestLocation.latitude, closestLocation.longitude);

                        if (currentSound !== closestLocation.soundFile) {
                            playSound(closestLocation.soundFile);
                            currentSound = closestLocation.soundFile;
                            updateStatus("Playing: " + closestLocation.soundFile);
                            showDistanceAndDirection(position.coords.latitude, position.coords.longitude);
                        }

                        // Use minDistance here
                        updateCompassBox(closestLocation, minDistance);
                    }
                }, function (error) {
                    updateStatus("Error: " + error.message);
                });
            } else {
                updateStatus("Geolocation is not supported by this browser.");
            }
        }




        function playSoundBasedOnLocation(latitude, longitude) {
            var closestLocation = findClosestLocation(latitude, longitude);
            if (closestLocation && currentSound !== closestLocation.soundFile) {
                playSound(closestLocation.soundFile);
                currentSound = closestLocation.soundFile;
                updateStatus("Playing: " + closestLocation.soundFile);
            }
        }

        function findClosestLocation(lat, lon) {
            var minDistance = Infinity;
            var closest = null;
            for (var i = 0; i < locations.length; i++) {
                var distance = getDistance(lat, lon, locations[i].latitude, locations[i].longitude);
                if (distance < minDistance) {
                    minDistance = distance;
                    closest = locations[i];
                }
            }
            return closest; // Removed the distance check
        }

        function getDistance(lat1, lon1, lat2, lon2) {
            // Haversine formula to calculate distance between two coordinates
            var R = 6371e3; // metres
            var φ1 = lat1 * Math.PI / 180;
            var φ2 = lat2 * Math.PI / 180;
            var Δφ = (lat2 - lat1) * Math.PI / 180;
            var Δλ = (lon2 - lon1) * Math.PI / 180;

            var a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                Math.cos(φ1) * Math.cos(φ2) *
                Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c;
        }


function togglePlayPause() {
    if (currentSound && currentSound.audio) {
        if (currentSound.audio.paused) {
            currentSound.audio.play();
            updateStatus("Playing: " + currentSound.file);
        } else {
            currentSound.audio.pause();
            updateStatus("Paused: " + currentSound.file);
        }
    }
}

function stopSound() {
    if (currentSound && currentSound.audio) {
        currentSound.audio.pause();
        currentSound.audio.currentTime = 0;
        updateStatus("Stopped: " + currentSound.file);
    }
}




        function playSound(soundFile) {
            // Check if currentSound exists and has a property 'audio'
            if (currentSound && currentSound.audio) {
                currentSound.audio.pause();
            }
            var audio = new Audio(soundFile);
            audio.play().catch(e => {
                // This is where the start button becomes necessary
                document.getElementById('startButton').style.display = 'block';
                updateStatus("Click the button to enable audio playback permissions in your browser.");
            });
            currentSound = { audio: audio, file: soundFile };

            // Display sound duration and remaining time
            audio.onloadedmetadata = function () {
                updateStatus("Playing: " + currentSound.file + " (Duration: " + audio.duration.toFixed(2) + " seconds)");
            };
            audio.ontimeupdate = function () {
                updateRemainingTime(audio.duration - audio.currentTime);
            };

            // Loop the sound if the user is still there
            audio.onended = function () {
                if (stillInLocation) {
                    audio.play();
                }
            };
              // If a sound is already playing, pause it
    if (currentSound && currentSound.audio && !currentSound.audio.paused) {
        currentSound.audio.pause();
    }
        }

        function updateRemainingTime(timeLeft) {
            document.getElementById('remainingTime').innerText = "Time Remaining: " + timeLeft.toFixed(2) + " seconds";
        }


        function updateCompassBox(closestLocation, distance) {
            if (!closestLocation) return;

            // Calculate the direction to the closest sound
            var direction = getDirection(userMarker.getLatLng().lat, userMarker.getLatLng().lng, closestLocation.latitude, closestLocation.longitude);
            var arrowDirectionStyle = 'transform: rotate(' + direction + 'deg);';

            // Update the compass arrow box
            var compassArrowElement = document.getElementById('compassArrow');
            var soundInfoElement = document.getElementById('soundInfo');
            var soundDistanceElement = document.getElementById('soundDistance');

            compassArrowElement.setAttribute('style', arrowDirectionStyle);
            soundInfoElement.innerText = 'Sound: ' + closestLocation.soundFile;
            soundDistanceElement.innerText = 'Distance: ' + distance.toFixed(2) + ' meters';
        }

        function getDirection(lat1, lon1, lat2, lon2) {
            var y = Math.sin(lon2 - lon1) * Math.cos(lat2);
            var x = Math.cos(lat1) * Math.sin(lat2) -
                Math.sin(lat1) * Math.cos(lat2) * Math.cos(lon2 - lon1);
            var brng = Math.atan2(y, x) * 180 / Math.PI;
            return brng < 0 ? brng + 360 : brng;
        }

        function updateStatus(message) {
            document.getElementById('status').innerText = message;
        }

        // Check the user's location every 2 seconds
        setInterval(checkLocationAndUpdateSound, 2000);

        // Initialize the Leaflet Map
        function initMap() {
            var mapCenter = getMapCenter(); // Get the center of all sound locations
            var map = L.map('map').setView(mapCenter, 17); // Adjust zoom level if necessary



            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            // Add markers for each location
            locations.forEach(function (location) {
                L.marker([location.latitude, location.longitude]).addTo(map)
                    .bindPopup(location.soundFile);
            });
        }


        function updateUserLocation(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;

            // Update user's map marker
            if (!userMap) {
                initUserMap(latitude, longitude);
            } else {
                userMarker.setLatLng([latitude, longitude]);
                userMap.setView([latitude, longitude], 17);
            }

            // Play sound and update distance and direction info
            playSoundBasedOnLocation(position.coords.latitude, position.coords.longitude);
            showDistanceAndDirection(userMap, position.coords.latitude, position.coords.longitude);
        }

        // Add this code to calculate the center of the sound locations
        function getMapCenter() {
            var latSum = 0, lonSum = 0;
            locations.forEach(function (loc) {
                latSum += loc.latitude;
                lonSum += loc.longitude;
            });
            return [latSum / locations.length, lonSum / locations.length];
        }

        function initUserMap(latitude, longitude) {
            // Initialize the map if not already done
            userMap = L.map('userMap').setView([latitude, longitude], 17);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap contributors'
            }).addTo(userMap);
            userMarker = L.marker([latitude, longitude]).addTo(userMap)
                .bindPopup('Your Location').openPopup();
        }


        function showDistanceAndDirection(map, lat, lon) {
            var closestLocation = findClosestLocation(lat, lon);
            if (closestLocation) {
                var distance = getDistance(lat, lon, closestLocation.latitude, closestLocation.longitude);
                var direction = getDirection(lat, lon, closestLocation.latitude, closestLocation.longitude);

                // Update distance info
                document.getElementById('distanceInfo').innerHTML =
                    'Closest Sound: ' + closestLocation.soundFile + '<br>' +
                    'Distance: ' + distance.toFixed(2) + ' meters' + '<br>' +
                    'Direction: ' + direction;

                // Add marker for closest sound location
                L.marker([closestLocation.latitude, closestLocation.longitude]).addTo(map)
                    .bindPopup(closestLocation.soundFile).openPopup();
            }
        }

        // Modified window.onload function
        window.onload = function () {
            initMap();
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    initUserMap(position.coords.latitude, position.coords.longitude);
                    checkLocationAndUpdateSound();
                }, function (error) {
                    console.error("Error getting location: " + error.message);
                });
            } else {
                console.log("Geolocation is not supported by this browser.");
            }

               document.getElementById('playPauseButton').addEventListener('click', togglePlayPause);
    document.getElementById('stopButton').addEventListener('click', stopSound);
        };


        document.getElementById('startButton').addEventListener('click', function () {
            checkLocationAndUpdateSound();
            this.style.display = 'none';
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    playSoundBasedOnLocation(position.coords.latitude, position.coords.longitude);
                }, function (error) {
                    updateStatus("Error: " + error.message);
                });
            } else {
                updateStatus("Geolocation is not supported by this browser.");
            }
        });

        // Call the location permission check function
checkLocationPermission();

    </script>

<script>
// Modular JavaScript structure for geolocation
const geoLocationModule = (function() {
    // Function to check geolocation availability and handle position
    function initGeolocation() {
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(handleSuccess, handleError);
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    }

    // Success handler for geolocation
    function handleSuccess(position) {
        // Existing success logic or function calls can be placed here
    }

    // Error handler for geolocation
    function handleError(error) {
        switch(error.code) {
            case error.PERMISSION_DENIED:
                alert("User denied the request for Geolocation.");
                break;
            case error.POSITION_UNAVAILABLE:
                alert("Location information is unavailable.");
                break;
            case error.TIMEOUT:
                alert("The request to get user location timed out.");
                break;
            default:
                alert("An unknown error occurred.");
                break;
        }
    }

    return {
        init: initGeolocation
    };
})();

// Initialize geolocation module on document load
document.addEventListener('DOMContentLoaded', function() {
    geoLocationModule.init();
});
</script>
</body>

</html>